version: "3"

services: 
    voters:
        image: edgedb/edgedb:1-beta2
        # ports: 
        #     - 16419:16419
        restart: on-failure
        environment: 
            - EDGEDB_PASSWORD=test
            - EDGEDB_USER=merak
            - EDGEDB_PORT=16419
        networks: 
            - voteredge
    
    papers:
        image: edgedb/edgedb:1-beta2
        # ports: 
        #     - 16420:16420
        restart: on-failure
        environment: 
            - EDGEDB_PASSWORD=test
            - EDGEDB_USER=merak
            - EDGEDB_PORT=16420
        networks: 
            - paperedge

    sessions:
        image: memcached:latest
        restart: on-failure
        networks:
            - sessions

    certcodes:
        image: memcached:latest
        restart: on-failure
        networks:
            - certcodes

    keybytes:
        image: memcached:latest
        restart: on-failure
        networks:
            - keybytes

    bundle_caches:
        image: memcached:latest
        restart: on-failure
        networks:
            - bundle_caches
    
    alcor:
        build:
            context: .
            network: host
            dockerfile: ./dockerfile
        restart: on-failure
        environment: 
            - MAX_CONNECTION=100000
            - EXPIRATION_TIME=120
        ports:
            - 9999:9999
            - 10000:10000
        links: 
            - voters
            - papers
            - sessions
            - keybytes
            - certcodes
        depends_on: 
            - voters
            - papers
            - sessions
            - keybytes
            - certcodes
        networks:
            - voteredge
            - paperedge
            - sessions
            - keybytes
            - certcodes

networks:
    voteredge:
    paperedge:
    sessions:
    certcodes:
    keybytes:
    bundle_caches: